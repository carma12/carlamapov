[{"content":"Introduction PatternFly 5 version was recently released in August 2023. This is a major upgrade of the previous version and has landed with some exciting new features. To mention some:\nIt supports React versions 17 and 18 They introduce new federated modules: a collection of independent remote software modules (associated with microfrontends) Updated implementation of some popular components: Wizard, Select, Dropdown, and Table Acessibility improvements The PatternFly team has also announced that they will adopt an annual major release cadence, so we can expect a PatternFly 6 library for mid-late 2024. This also means that the previous version of PatternFly 4 library will be only maintained for addressing high-priority issues until PF6 is available, because they will be commited to maintain two PatternFly versions at the same time.\nAs a consumer of the previous one (PF4), this sounds really exciting and I couldn\u0026rsquo;t wait to check the newly released PatternFly 5 library. So I would like to share my experience adapting this library to the modern FreeIPA WebUI project and providing some hints that I learned during the process. I hope this will help you for a successful migration ;-)\nMigration steps Upgrade PF version The first step will be to upgrade the PatternFly libraries to its latest version. Easy as that.\nIn my case, as I\u0026rsquo;m using NodeJS I can rely on the npm command to upgrade the three specific PF libraries in a single line:\n1 npm install @patternfly/patternfly@latest @patternfly/react-core@latest @patternfly/react-table@latest The result:\n1 2 3 4 5 6 \u0026#34;dependencies\u0026#34;: { \u0026#34;@patternfly/patternfly\u0026#34;: \u0026#34;^5.1.0\u0026#34;, \u0026#34;@patternfly/react-core\u0026#34;: \u0026#34;^5.1.1\u0026#34;, \u0026#34;@patternfly/react-table\u0026#34;: \u0026#34;^5.1.1\u0026#34;, // (...) }, If your project uses any other PF library, the command mentioned above still will do the trick. Feel free to check the promoted package versions) for further information.\nPatternFly Codemods To make the migration easier, the PatternFly team has released a set of codemods to easily change, identify, and fix major issues. These can automatically adapt and resolve a large amount of problems on the code and flag any component that might require manual update.\nIn the oficial guidelines, they recommend to use two specific codemods:\npf-codemods is an eslint wrapper to update @patternfly/react-core@4.x.x code to 5.x.x. It will also assign some deprecated components with the @deprecated library. class-name-updater automatically identifies Patternfly class names that need to be updated after the introduction of versioned class names in Patternfly v5. For example: the class pf-u-mt-lg will be transformed into pf-v5-u-mt-lg. Those can be run in several steps regardless of the order. And there is something else to take into account: those codemods are meant to be used before making any manual changes to the code. That means that those errors and warnings can still be there even when you have resolved them, leading to the \u0026ldquo;what-did-just-happened??\u0026rdquo; loop. So just to take it into account :-)\npf-codemods To use this codemod and check the errors and warnings, we just execute the following command:\n1 npx @patternfly/pf-codemods@latest \u0026lt;path-to-source-code\u0026gt; To allow the autofix to apply changes into our code (I strongly recommend this approach), we add the --fix argument:\n1 npx @patternfly/pf-codemods@latest \u0026lt;path-to-source-code\u0026gt; --fix class-name-updater This codemod works very similar as the one that was mentioned before: it can be executed to check the occurrencies or to fix them. The last one is the most useful in this case, IMHO.\n1 npx @patternfly/class-name-updater \u0026lt;path-to-source-code\u0026gt; --fix Upgrade deprecated components PatternFly 5 deprecates old implementations of some components in favor of new ones. These are:\nSelect Dropdown Table Wizard Context selector Application launcher Options menu Page header Those will remain in the code base until, at least, the next major release (PF6).\nSo for those projects that started with the previous PF4 version (like the new FreeIPA WebUI), is important to adapt those components to use the new ones. In order to do so, we just need to search in your code any PatternFly library that has the deprecated suffix. E.g. using the Select components:\n1 2 3 4 5 6 import { Select, SelectOption, SelectVariant, SelectDirection, } from \u0026#34;@patternfly/react-core/deprecated\u0026#34;; Once we identify the deprecated components in our code, we just need to replace them by the non-deprecated ones referencing the @patternfly/react-core library.\n1 2 3 4 5 6 import { Select, SelectOption, SelectVariant, SelectDirection, } from \u0026#34;@patternfly/react-core\u0026#34;; It is important to note that some parameters and variables can be different from the deprecated version to the current one, so those will need to be changed. This effort may vary depending on how big is our project and the components used. Following the same example with the Select example:\nDeprecated component:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;Select id=\u0026#34;revocation-certificate-authority\u0026#34; variant=\u0026#34;single\u0026#34; placeholderText=\u0026#34; \u0026#34; aria-label=\u0026#34;Select a certificate authority for the revocation\u0026#34; aria-labelledby=\u0026#34;revocation certificate authority\u0026#34; selections={CASelected} isOpen={isCAOpen} onToggle={(_event, isOpen: boolean) =\u0026gt; onCAToggle(isOpen)} onSelect={onCASelect} \u0026gt; {CAOptions.map((option, index) =\u0026gt; ( \u0026lt;SelectOption key={index} value={option} /\u0026gt; ))} \u0026lt;/Select\u0026gt; New component:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;Select id=\u0026#34;revocation-certificate-authority\u0026#34; aria-label=\u0026#34;Select a certificate authority for the revocation\u0026#34; aria-labelledby=\u0026#34;revocation certificate authority\u0026#34; selected={CASelected} isOpen={isCAOpen} toggle={toggleCASelect} onSelect={onCASelect} \u0026gt; {CAOptions.map((option, index) =\u0026gt; ( \u0026lt;SelectOption key={index} value={option}\u0026gt; {option} \u0026lt;/SelectOption\u0026gt; ))} \u0026lt;/Select\u0026gt; Not only the component parameters, but also the expected method parameters can change. Following with the example as a reference, the onToggle parameter has been transformed into toggle and it must be returned as a reference:\nNew component:\n1 2 3 4 5 6 // Toggle const toggleCASelect = (toggleRef: React.Ref\u0026lt;MenuToggleElement\u0026gt;) =\u0026gt; ( \u0026lt;MenuToggle ref={toggleRef} onClick={onCAToggle} className=\u0026#34;pf-v5-u-w-100\u0026#34;\u0026gt; {CASelected} \u0026lt;/MenuToggle\u0026gt; ); Leftovers on building At this point, most (if not all) problems should be fixed. However, I strongly recommend to build your project and address any possible errors and leftovers in the code.\nAs the new FreeIPA WebUI is relying on Webpack, I just had to use the alias (npm run start). But if your React project uses another bundler such as create-react-app, you can build it via npm run build. In any case, a double-check on the project to detect any unexpected errors won\u0026rsquo;t hurt.\nBonus: Cypress Although this is not mentioned in the official guide, it is good to keep in mind when migrating in React projects.\nIf your project is using Cypress to perform integration and/or e2e tests, you might also want to adapt the tests and replace old the class names to PatternFly 5 ones. As some of the components have changed their core structure, this will likely cause tests to fail if they are referencing deprecated structures. This only applies to the newly implemented components that we mentioned above.\nE.g.: Cypress code using deprecated class names (dropdown__toggle-text):\n1 2 3 cy.get( \u0026#34;div.pf-v5-c-masthead__content button span.pf-v5-c-dropdown__toggle-text\u0026#34; ).then(($ele) =\u0026gt; { ... }; E.g.: Cypress code using PF5 class names (menu-toggle__text):\n1 2 3 cy.get( \u0026#34;div.pf-v5-c-masthead__content button span.pf-v5-c-menu-toggle__text\u0026#34; ).then(($ele) =\u0026gt; { ... }; Conclusions We have introduced the main PatternFly 5 key features and offered a comprehensive guide on migrating any React project to the latest version of the library. I think the PatternFly team did (and are already doing) a great job on this major release. Looking forward to see the next features.\nAs this guide is base on my personal experience, some gaps and corner cases might have been not covered enough, so any comments or extra tips are more than welcome. Thanks for reading!\nPhoto by Andrew Ridley on Unsplash\n","date":"2023-12-19T00:00:00Z","image":"/p/pf4-to-pf5-migration/andrew-ridley-jR4Zf-riEjI-unsplash_hu3d03a01dcc18bc5be0e67db3d8d209a6_2682219_120x120_fill_q75_box_smart1.jpg","permalink":"/p/pf4-to-pf5-migration/","title":"Migrating PatternFly v4 to v5"},{"content":"First post of my blog.\nHey! :D\nPhoto by Pawel Czerwinski on Unsplash\n","date":"2022-03-06T00:00:00Z","image":"/p/hello-world/cover_hud7e36f7e20e71be184458283bdae4646_55974_120x120_fill_q75_box_smart1.jpg","permalink":"/p/hello-world/","title":"Hello World"}]